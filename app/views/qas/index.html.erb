<header class="flex-parent">
  <h1 class="flex-child"><%= link_to image_tag("4dxlogo.svg"), root_path %></h1>
  <div class="nav flex-child">
    <%= link_to '<i class="material-icons menu">people</i>'.html_safe, teams_path %>
    <%= link_to '<i class="material-icons">person</i>'.html_safe, members_path %>
    <i class="material-icons menu active">done_all</i>
    <%= link_to '<i class="material-icons">assignment</i>'.html_safe, qa_path(@teams, :format => "pdf"), target: '_blank' %>
  </div>
  <div class="flex-child relative">
  <i class="material-icons flex-child active"><a title="Add Widget" data-toggle="modal" href="#addQAItem">person_add</a></i>
  <div class="modal" id="addQAItem">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
          <h4 class="modal-title">Add a WIG Item to a Member</h4>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-lg-12">
              <%= simple_form_for @qa do |f| %>
              <%= f.input :team_id, :collection => @teams, :include_blank => 'Choose A Team', label: false %>
              <select name="qa[member_id]" class="select required form-control">
                <option value="Choose information">Choose A Member</option>
                <% if !@teams.blank? %>
                <% for item in @teams %>
                <% if !item.members.blank? %>
                <% for mem in item.members %>
                <option class="members" value="<%= mem.id %>" data-team-<%= item.id %>><%=mem.name%></option>
                <% end %>
                <% else %>
                <% end %>
                <% end %>
                <% else %>
                <% end %>
              </select>
              <%= f.input :title, :placeholder => 'QA Title', label: false %>
              <%= f.button :submit %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</header>
<body>

  <div id="container">
  </div>

  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve" class="moon">
    <path d="M86.576,84.239c-0.102-0.44-0.448-0.781-0.889-0.876c-1.441-0.311-2.879-0.689-4.271-1.127  C66.969,77.707,55.8,66.938,50.77,52.692C45.739,38.445,47.67,23.05,56.07,10.454c0.812-1.218,1.692-2.415,2.617-3.559  c0.284-0.351,0.339-0.834,0.143-1.24C58.632,5.25,58.219,4.994,57.768,5c-4.879,0.064-9.708,0.928-14.354,2.568  c-23.396,8.261-35.71,34.016-27.449,57.412c8.261,23.397,34.017,35.711,57.414,27.45c4.645-1.64,8.945-3.999,12.783-7.014  C86.516,85.138,86.678,84.679,86.576,84.239z">
    </path>
  </svg>

  <% @teams.each do |team| %>
  <div class="team" id="icon<%= team.id %>">
    <div class="accordion">
      <h2><i id="icon<%= team.id %>x" class="material-icons" data-position="up">expand_more</i><%= team.name %></h2>
      <div class="member-list flex-parent">
        <% team.members.each do |member| %>
        <div class="member">
          <h3 class="member-name"> <%= member.name %></h3>
          <ul>
            <% member.qas.each do |qa| %>
            <% if qa.team_id == team.id %>
            <% unless qa.completed? %>
            <%= form_for(qa) do |f| %>
            <li class="qa-item flex-parent"><p class="flex-item qa-name"><%= qa.title %></p><input type="hidden" value="1" name="qa[completed]"id="qa_completed"> <%= f.submit "done", class: "flex-item material-icons qa-buttons qa-yes" %></li>
            <% end %>
            <% end %>
            <% end %>
            <% end %>
          </ul>
        </div>
        <% end %>
      </div>
    </div>
    <% end %>
  </div>

  <script>
//dynamic form selection
$(document).ready(function(){
  $('#qa_team_id').change(function(){
    $('.members').hide();
    var selectedTeamID = $('#qa_team_id option:selected').val();
    $('.members[data-team-'+selectedTeamID+']').show();

  })
})

//accordion
$(function() {
  $( ".accordion").accordion({
    collapsible: true,
    active: false,
    heightStyle: "content"
  });

  <% @teams.each do |team| %>
    $("#icon<%= team.id %>").click(function(){
      var x = document.getElementById("icon<%= team.id %>x").getAttribute('data-position');
      if (x == "up") {
        document.getElementById("icon<%= team.id %>x").style.transform = "rotate(180deg)"; 
        $("#icon<%= team.id %>x").attr('data-position', "down");       
      }
      else{
        document.getElementById("icon<%= team.id %>x").style.transform = "rotate(0deg)";        
        $("#icon<%= team.id %>x").attr('data-position', "up");       
      };
    })
  <% end %>
});
</script>
</body>
